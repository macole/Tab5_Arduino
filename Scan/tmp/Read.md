こうしたライブラリはC/C++で書かれており、Arduinoのスケッチ（拡張子.ino）とは少し異なります。これらライブラリのプログラムをインクルードしてやることで利用可能となります。

一方で自分自身でこうしたプログラムを書くことができれば、ライブラリとして登録し、いつでも呼び出して使うことが可能となるわけです。また、一旦作成してしまえば以降C/C++であることを意識せずにArduinoのプログラムとして利用することができます。

それではこれからライブラリの作成方法を見ていきましょう。


ライブラリの作成
ライブラリを自作する際には、C/C++のプログラムを用意する必要があります。C/C++はヘッダファイル（拡張子.h）と対応するソースファイル（拡張子.cpp）からなります。（稀にヘッダファイルのみの場合なんかもあったりします。）

まずはヘッダファイルを作成しましょう。ヘッダファイルには対応するソースファイルの情報を記載します。このヘッダファイルをインクルードすることでソースファイルの中のプログラムをどのように利用するかがコンパイラ（プログラムのテキストファイルを実際のソフトウェアにする部分）に伝わり、利用することができるようになります。より正確に言うとヘッダファイルには変数や関数、クラスなどの宣言が書かれています。

試しに簡単な関数をいくつか用意したテスト用ライブラリを作ってみます。まずはスケッチを作成し、library_test.inoとします。

それではヘッダファイル、ソースファイルを用意します。ArduinoIDEの右上「…」のボタンを押し、”新しいタブ”を選択します。（図３）

図４のようなウインドウが表示されたら、名前を入力してOKを押します。今回はTestLib1.hという名前にします。同様に対応するソースファイルであるTestLib1.cppも作成します。


図３：新規ファイルを用意する手順。1. 右上の…ボタンを押し、2. 新しいタブを選択

図４：新しいファイルの作成。名前を入力してOKを押す。
このとき気をつけなくてはいけないのは「インクルードガード」と呼ばれる部分です。ヘッダファイルは通常いくつかのファイルでインクルードされます。しかし、一つのヘッダファイルがひとつのプログラムで複数回読み込まれ宣言部分が何度も利用され、同じ変数や関数、クラスが多重で宣言されるのは問題となります。そのため全体で一度だけインクルードされるようにする仕組みがあります、それがインクルードガードです。

ではヘッダファイルにインクルードガード部分を記述します。TestLib1.hに次のように記述します。
-