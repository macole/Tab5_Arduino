AccX
下：１　横：０　上：−１
AccY
左：１　横：０　右：−１
Acc Z
画面：１　奥：−１

項目
IMU（慣性計測装置）
ジャイロセンサー
概要
加速度センサー、ジャイロセンサーなどを組み合わせたデバイス
物体の回転（角速度）を検出するセンサー
検出できる動き
並進運動と回転運動の両方
回転運動のみ
主な役割
姿勢や軌跡の把握、制御
角速度の計測
補足
複数のセンサーの情報を組み合わせることで、より高度な運動情報を取得する
外部からの衝撃や振動に影響を受けやすいという欠点がある


ーーー

慣性計測ユニット（IMU）を構成するために使用される主要なセンサーと、それらの役割および処理ステップは以下の通りです。
主要な構成要素（センサー）
慣性計測ユニット（IMU）は、一般的に以下の3種類の従来のセンサーを使用して実装されます。これらのセンサーはそれぞれ、X、Y、Zの3方向のベクトルを生入力として提供します。
1. 加速度計（Accelerometer）
    ◦ 役割: デバイスが測定を行っている際の加速度の生の値（A 
x
​
 ,A 
y
​
 ,A 
z
​
 ）を提供します。これらの値はデバイスの座標系（ボディ座標）で相対的に得られます。
2. ジャイロスコープ（Gyroscope）
    ◦ 役割: デバイスの角速度に関する生の値（G 
x
​
 ,G 
y
​
 ,G 
z
​
 ）を提供します。
3. 磁力計（Magnetometer）
    ◦ 役割: 地磁気フィールドに関する生の値（M 
x
​
 ,M 
y
​
 ,M 
z
​
 ）を提供します。これは、デバイスの方位（ヘディング）を決定するために重要です。
主要な処理システムとその役割
これらの生入力を意味のある姿勢や位置情報に変換するためには、センサーフュージョン（Sensor Fusion）が必要です。
• 姿勢・方位基準システム（AHRS: Attitude Heading in Reference System）
    ◦ 役割: 9つの入力（加速度計、ジャイロスコープ、磁力計のX, Y, Z）全ての間で何らかのセンサーフュージョンを実行し、よりクリーンで正確なデータを得るために互いのエラーを打ち消し合います。
    ◦ 出力（中間）: AHRSの実装（例：Madgwickクォータニオン更新）を通じて、クォータニオンが出力されます。
        ▪ クォータニオンの役割: 抽象的な数学的概念ですが、3次元環境における角度（ピッチ、ヨー、ロール）を表す方法として使用されます。
最終的な出力と変換の役割
AHRSによって得られたクォータニオンと、生入力の加速度データを処理することで、IMUから以下の重要な出力が得られます。


1. 姿勢角（Pitch, Yaw, Roll / ピッチ、ヨー、ロール）
    ◦ 役割: クォータニオンから導出される、デバイスの3次元的な角度を表す値です。
    ◦ 補正: 磁力計のデータに基づいているため、磁気偏角オフセットを適用して磁北から真北へ値を回転させる必要があります。


2. 絶対加速度ベクトル（Absolute Acceleration Vector）
    ◦ 役割: デバイスに相対的なボディ座標ではなく、**北（North）、東（East）、下（Down）（NED）**といったより理解しやすい形式で絶対的な加速度を出力することです。
    ◦ 変換プロセス:
        ▪ クォータニオンを**回転行列（Rotation Matrix）**に変換します。
        ▪ この回転行列を使用して、ボディ座標の加速度ベクトルをNED座標に変換します。
        ▪ この変換プロセスにより、重力（Gravity）成分を方程式から取り除くことが可能になります。
        ▪ 重力を除去することで、デバイスが静止している時には加速度が0, 0, 0となり、絶対的な加速度（Absolute acceleration）として非常に扱いやすくなります。
    ◦ 補正: 加速度ベクトルにも、磁気偏角オフセットを適用して絶対的な北の方向に合わせる必要があります。
このように、IMUは個々のセンサーが提供する生データ（加速度、角速度、磁場）をAHRS内で高度にフュージョンし、回転行列やクォータニオンといった数学的ツールを用いて変換することで、**姿勢（ピッチ、ヨー、ロール）と絶対的な位置情報（絶対加速度）**という、ローカライゼーション問題（自己位置推定）を劇的に単純化する出力（）を提供するシステムです。


https://watako-lab.com/2019/01/01/m5stack_sens_9axis/#:~:text=9%E8%BB%B8%E3%82%BB%E3%83%B3%E3%82%B5%E3%81%A8%E3%81%AF,%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%82%92%E4%BD%9C%E6%88%90%E3%81%97%E3%81%BE%E3%81%97%E3%81%9F%E3%80%82



M5Stack Grayを使って、9軸センサの制御方法を解説しているページです。
最新の更新情報は、「9軸センサ制御」のタグで、記事にしています。

9軸センサ実験用デバイスの紹介

9軸センサとは「3軸加速度 + 3軸角速度 + 3軸方位センサ」 の機能を持つセンサです。

M5Stack Grayには、9軸センサとしてMPU9250が搭載されています(写真は緑色塗装品)。

今回は、写真のようなロール・ピッチ・ヨーの順に回転可能なデバイスを作成しました。

このデバイスを用いて、9軸センサ制御について勉強した内容をまとめたいと思います。

※筆者のポリシーから、コピペできるソースコードは一切掲載しておりません。代わりに、なるべく分かりやすく動作原理を解説できれば、と思っています。

※また、制御の勉強と執筆を並行しているので、間違った内容が記載される可能性、および修正される可能性があることを念頭に置いてください。

最新の成果物
9軸センサを使うと、こんな感じで物体の姿勢を検知できるようになるよ。



解説記事の一覧
9軸センサを制御する上で必要な知識を解説しています。

次の順で、知識を積み重ねながら学ぶことを前提に記載しています。

３次元ベクトルの回転「ロール・ピッチ・ヨー」
9軸センサを使う目的は、主に現在の「姿勢」を知るためです。その姿勢を表現する上で、３次元ベクトルの「回転」の知識が必要になります。また、姿勢表現の一つである「ロール・ピッチ・ヨー」の考え方も解説しています。
　⇒ 詳細記事はこちら

X軸：ロール（手前軸）
Y軸：ピッチ（右軸）
Z軸：ヨー（上軸）

https://watako-lab.com/wp-content/uploads/2019/01/rot_zAxis.png


３軸加速度センサを用いた姿勢推定
加速度センサの値から「ロール・ピッチの回転角」を算出してみる話です。また、この分野でよく登場する「センサ座標系」と「グローバル座標系」の考え方も解説しています。
　⇒ 詳細記事はこちら

３軸方位センサを用いた姿勢推定
前回の加速度センサだけでは検知できなかった「ヨー回転角」について、３軸方位センサを使って算出してみる話です。
　⇒ 詳細記事はこちら

３軸角速度センサを用いた姿勢推定
加速度・方位センサが苦手とする「高周波な(=細かい)動作の検知」を実現するため、角速度センサを用いて姿勢を算出してみる話です。
　⇒ 詳細記事はこちら

相補フィルタによるセンサフュージョン
それぞれのセンサの弱点を補うため、複数のセンサを使って姿勢を推定する方法を「センサフュージョン」と呼びます。今回は、相補フィルタによるセンサフュージョンをしてみた話です。
　　　⇒ (現在、執筆中。たぶん、時間かかります)

今後の予定
・各種センサの組み合わせ手法(センサフュージョン)の解説
・クォータニオンについての解説


画面：
左上：０、０
右下： 720x1280

